struct(
tempTbl1.idVisitor as idVisitor,
tempTbl1.metierIdsVisitor as metierIdsVisitor,
tempTbl1.isRobot as isRobot,
tempTbl1.isAnonymous as isAnonymous,
tempTbl1.typeSupport as typeSupport,
tempTbl1.appliDetail as appliDetail,
zip_with(offset(transform(tempTbl1.visites, x -> cardinality(x.recherches))),tempTbl1.visites, (n,x) -> struct(x.idVisite as idVisite, x.metierIdsVisite as metierIdsVisite, x.portail as portail, x.isDirect as isDirect, x.libSource as libSource, x.grpSource as grpSource, x.noSource as noSource, x.liSource as liSource, x.noSourceDetail as noSourceDetail, x.liSourceDetail as liSourceDetail, x.commenceParAccueil as commenceParAccueil, x.pageEntreeAt as pageEntreeAt, x.robotDetectionLevel as robotDetectionLevel, x.typeAccesVisite as typeAccesVisite, x.typeClient as typeClient, x.typeSource as typeSource, x.userAgent as userAgent, x.xtor as xtor, x.pagesAccueil as pagesAccueil, x.pagesAT as pagesAT, x.sourcesAT as sourcesAT, x.at as at, x.tauxMatching as tauxMatching, x.publisherAT as publisherAT, x.mvTesting as mvTesting, n as recherches_link )) as visites,tempTbl1.annotations as annotations,flatten(
           transform(filter(tempTbl1.visites, x -> cardinality(x.recherches) >= 0),
             x -> transform(x.recherches, y -> struct(x.idVisite as visite_idVisite,x.metierIdsVisite as visite_metierIdsVisite,x.portail as visite_portail,x.isDirect as visite_isDirect,x.libSource as visite_libSource,x.grpSource as visite_grpSource,x.noSource as visite_noSource,x.liSource as visite_liSource,x.noSourceDetail as visite_noSourceDetail,x.liSourceDetail as visite_liSourceDetail,x.commenceParAccueil as visite_commenceParAccueil,x.pageEntreeAt as visite_pageEntreeAt,x.robotDetectionLevel as visite_robotDetectionLevel,x.typeAccesVisite as visite_typeAccesVisite,x.typeClient as visite_typeClient,x.typeSource as visite_typeSource,x.userAgent as visite_userAgent,x.xtor as visite_xtor,x.pagesAccueil as visite_pagesAccueil,x.pagesAT as visite_pagesAT,x.sourcesAT as visite_sourcesAT,x.at as visite_at,x.tauxMatching as visite_tauxMatching,x.publisherAT as visite_publisherAT,x.mvTesting as visite_mvTesting, y.idRecherche as idRecherche,y.rep_passerelle as rep_passerelle,y.rep_univers as rep_univers,y.typereponse as typereponse,y.typeRecherche as typeRecherche,y.typeRechercheSec as typeRechercheSec,y.typeRechercheSSA as typeRechercheSSA,y.typeRechercheAgg as typeRechercheAgg,y.modeRecherche as modeRecherche,y.modeRechercheSec as modeRechercheSec,y.modeRechercheSSA as modeRechercheSSA,y.typeOu as typeOu,y.typeLoc as typeLoc,y.ouValeur as ouValeur,y.ouSaisi as ouSaisi,y.analyseIdLieu as analyseIdLieu,y.quoiQui as quoiQui,y.monoQuoiQui as monoQuoiQui,y.monoQuoiQuiSaisi as monoQuoiQuiSaisi,y.an9Recherche as an9Recherche,y.an9AfficheEnrichi as an9AfficheEnrichi,y.an9Reponse as an9Reponse,y.modeGeographique as modeGeographique,y.isGeoloc as isGeoloc,y.isProximite as isProximite,y.codesLieuxBag as codesLieuxBag,y.mnemoniqueSaisi as mnemoniqueSaisi,y.isCartoUsed as isCartoUsed,y.referrerDomain as referrerDomain,y.horodate as horodate,y.featureFlipping as featureFlipping,y.analyse_typesboost as analyse_typesboost,y.termes as termes,y.motscles as motscles,y.motsclesAffiches as motsclesAffiches,y.compteursMotsCles as compteursMotsCles,y.cris as cris,y.crisAffiches as crisAffiches,y.rubriquesFinesAffichees as rubriquesFinesAffichees,y.typeUV as typeUV,y.debrayageUV as debrayageUV,y.debrayageProximite as debrayageProximite,y.hasAt as hasAt,y.typeAccesRecherche as typeAccesRecherche,y.autocomplete as autocomplete,y.nbPagesAfficheesLR as nbPagesAfficheesLR,y.isRechercheCoupee as isRechercheCoupee,y.nbBlocsGratuits as nbBlocsGratuits,y.nbBlocsPayants as nbBlocsPayants,y.nbBlocsLocaux as nbBlocsLocaux,y.nbBlocsExtraLocaux as nbBlocsExtraLocaux,y.produitsPub as produitsPub,y.pushBonPlans as pushBonPlans,y.fdSeo as fdSeo,y.varianteOGR as varianteOGR,y.tracabiliteOGR as tracabiliteOGR,y.rechercheXTOR as rechercheXTOR,y.polePosition as polePosition,y.history as history,y.kpis as kpis,y.visiteurPositionLongitude as visiteurPositionLongitude,y.visiteurPositionLatitude as visiteurPositionLatitude,y.recherchePositionLongitude as recherchePositionLongitude,y.recherchePositionLatitude as recherchePositionLatitude,y.flagDatadome as flagDatadome,y.apiPartenaire as apiPartenaire,y.apiPartenaireDetail as apiPartenaireDetail,y.isSensible as isSensible,y.requete as requete)) )) as recherches)